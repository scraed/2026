<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>Modern diffusion models are built upon two fundamental processes: the forward process, which gradually corrupts data with noise during training, and the reverse process, which generates data by sampling from noise. The development of diffusion models has diverged into several valuable perspectives, illuminating different aspects of these processes. Most interpretations fall into three main frameworks: the Variational Autoencoder (VAE) perspective, the score-based perspective, and the flow-based perspective. Although there are many tutorials available, learning the core theory of diffusion models remains challenging for beginners due to mathematically dense derivations and fragmented intuitions scattered across these different perspectives.</p> <p>«««&lt; HEAD The VAE perspective treats the forward diffusion process as an encoder that adds noise to the data and the reverse process as a decoder that removes noise, with the Evidence Lower Bound (ELBO) serving as the training objective <d-cite key="Luo2022UnderstandingDM"></d-cite><d-cite key="Ho2020DenoisingDP"></d-cite>. This framework is straightforward for those familiar with VAEs. However, it does not clearly explain why the iterative denoising in diffusion models outperforms the one-step decoding typical of ordinary VAEs.</p> <p>The score-based perspective <d-cite key="Song2020ScoreBasedGM"></d-cite> places a clearer emphasis on the paired relationship between the forward and reverse processes, which makes diffusion models superior. It typically introduces the forward process first, and then presents the reverse process by referencing Anderson (1982) <d-cite key="Anderson1982ReversetimeDE"></d-cite>. However, fully understanding the reverse process in this framework requires familiarity with advanced concepts such as the Kolmogorov backward equations and the continuity equation, which makes this approach less accessible. Additionally, the score matching objective is specifically tailored for score models, making it less straightforward to generalize to other approaches such as flow matching models.</p> <h1 id="a-third-valuable-viewpoint-is-the-flow-based-perspective--which-has-rapidly-gained-popularity-in-modern-diffusion-models-although-this-approach-is-theoretically-equivalent-to-both-the-vae-and-score-based-frameworks--it-distinguishes-itself-by-highlighting-a-clear-and-intuitive-straight-line-interpolation-between-data-and-noise-this-conceptual-clarity-makes-the-flow-based-perspective-accessible-and-attractive-however-its-simplicity-can-be-misleading-it-can-give-the-impression-that-it-is-a-fundamentally-simpler-model-rather-than-an-equivalent-reformulation-of-other-perspectives">A third valuable viewpoint is the flow-based perspective <d-cite key="liu2022flow"></d-cite>, which has rapidly gained popularity in modern diffusion models. Although this approach is theoretically equivalent to both the VAE and score-based frameworks <d-cite key="gao2025diffusion"></d-cite>, it distinguishes itself by highlighting a clear and intuitive straight-line interpolation between data and noise. This conceptual clarity makes the flow-based perspective accessible and attractive. However, its simplicity can be misleading: it can give the impression that it is a fundamentally simpler model rather than an equivalent reformulation of other perspectives.</h1> <p>The <strong>VAE perspective</strong> treats the forward diffusion process as an encoder that adds noise to the data and the reverse process as a decoder that removes noise, with the Evidence Lower Bound (ELBO) serving as the training objective <d-cite key="Luo2022UnderstandingDM"></d-cite><d-cite key="Ho2020DenoisingDP"></d-cite>. This framework is straightforward for those familiar with VAEs. However, it does not clearly explain why the iterative denoising in diffusion models outperforms the one-step decoding typical of ordinary VAEs.</p> <p>The <strong>score-based perspective</strong> <d-cite key="Song2020ScoreBasedGM"></d-cite> places a clearer emphasis on the paired relationship between the forward and reverse processes, which makes diffusion models superior. It typically introduces the forward process first, and then presents the reverse process by referencing Anderson (1982) <d-cite key="Anderson1982ReversetimeDE"></d-cite>. However, fully understanding the reverse process in this framework requires familiarity with advanced concepts such as the Kolmogorov backward equations and the continuity equation, which makes this approach less accessible. Additionally, the score matching objective is specifically tailored for score models, making it less straightforward to generalize to other approaches such as flow matching models.</p> <p>A third valuable viewpoint is the <strong>flow-based perspective</strong> <d-cite key="liu2022flow"></d-cite>, which has rapidly gained popularity in modern diffusion models. Although this approach is theoretically equivalent to both the VAE and score-based frameworks <d-cite key="gao2025diffusion"></d-cite>, it distinguishes itself by highlighting a clear and intuitive straight-line interpolation between data and noise. This conceptual clarity makes the flow-based perspective accessible and attractive. However, its simplicity can be misleading: it can give the impression that it is a fundamentally simpler model rather than an equivalent reformulation of other perspectives.</p> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <p>ae03a9b9d99f81bf1ace2e5c2b67868b52a341ac</p> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> <p>In this article, we aim to present a perspective that is both mathematically simple and intuitively clear: the Langevin perspective. This approach, relying only on fundamental techniques from stochastic differential equations (SDEs), provides a straightforward derivation of the reverse processes as well as a unified, first-principle derivation of the denoising, score matching, and flow matching objectives.</p> <div class="insight-box"> <p><strong>Central Insight:</strong> The Langevin perspective reveals a fundamental triangular relationship:</p> <div class="row mt-3"> <div class="col-md-12 col-lg-10 offset-lg-1 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-reverse-langevin-480.webp 480w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-reverse-langevin-800.webp 800w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-reverse-langevin-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-reverse-langevin.png" class="img-fluid rounded" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>This illustrates that the forward and reverse diffusion steps are simply a <strong>split</strong> of a single step of Langevin dynamics.</p> </div> <h1 id="langevin-dynamics-as-identity-operation">Langevin Dynamics as ‘Identity’ Operation</h1> <p>Langevin dynamics <d-cite key="Langevin1908"></d-cite> is a stochastic process for sampling from a target probability distribution \(p(\mathbf{x})\). One common form is the SDE:</p> \[d\mathbf{x}_t = g(t)\, \mathbf{s}(\mathbf{x}_t) dt + \sqrt{2 g(t)}\, d\mathbf{W}_t,\] <p>where \(s(\mathbf{x}) = \nabla_{\mathbf{x}} \log p(\mathbf{x})\) is the score function of \(p(\mathbf{x})\), $g(t)$ is an arbitrary positive function satisfying $s = \int_0^\infty g(t) dt = \infty$. The $d\mathbf{W}$ term is a Brownian noise what can be treated as $\sqrt{dt} \boldsymbol{\epsilon}$, where $\boldsymbol{\epsilon}$ is a standard Gaussian noise.</p> <p>This dynamics is often used as a Monte Carlo sampler to draw samples from \(p(\mathbf{x})\), since \(p(\mathbf{x})\) is its <strong>stationary distribution</strong>—the distribution that \(\mathbf{x}_t\) converges to and and remains at as \(t \to \infty\), regardless of the initial distribution of \(\mathbf{x}_0\).</p> <details> <summary>Optional: Derivation that $p(\mathbf{x})$ is the stationary distribution of Langevin dynamics</summary> <div class="details-content"> <ol> <li> <p>Set $g(t) = 1$ by rescaling time as $t’ = \int_0^t g(\tau)\, d\tau$. Under this change of variables, the dynamics become \(d\mathbf{x}_{t'} = \mathbf{s}(\mathbf{x}_{t'})\, dt' + \sqrt{2}\, d\mathbf{W}_{t'}\), which is equivalent to the case $g(t’) = 1$. Thus, $g(t)$ only sets the time unit and does not affect the stationary distribution.</p> </li> <li> <p>Write the dynamics in “energy” form as \(d\mathbf{x}_t = -\nabla E(\mathbf{x})\,dt + \sqrt{2}\,d\mathbf{W}_t\). The random term $d\mathbf{W}_t$ perturbs the system toward equilibrium, where states with the same energy $E(\mathbf{x})$ should have equal probability. Thus, the stationary distribution is $p(\mathbf{x}) = f(E(\mathbf{x}))$ for some function $f$.</p> </li> <li> <p>Consider $N$ independent copies $\mathbf{x}_1, \dots, \mathbf{x}_N$. Their joint density is the product $f(E(\mathbf{x}_1)) \cdots f(E(\mathbf{x}_N))$. When treating them as a single system, the total energy is additive: $E(\mathbf{x}_1, \dots, \mathbf{x}_N) = \sum E(\mathbf{x}_i)$. Therefore, the joint stationary density must also be $g(\sum E(\mathbf{x}_i))$ for some function $g$. The only function $f$ that turns products into additions is the exponential: $f(E) = e^{-\beta E}$. This yields $p(\mathbf{x}) \propto e^{-\beta E(\mathbf{x})}$.</p> </li> <li> <p>To find $\beta$, take $E(\mathbf{x}) = \frac{1}{2} |\mathbf{x}|^2$, giving the well known Ornstein–Uhlenbeck process $d\mathbf{x}_t = -\mathbf{x}\,dt + \sqrt{2}\,d\mathbf{W}_t$ <d-cite key="OrnsteinUhlenbeckWikipedia"></d-cite> with known stationary $\mathcal{N}(0, I)$, density $\propto e^{-\frac{1}{2} |\mathbf{x}|^2}$. Matching forms gives $\beta = 1$.</p> </li> </ol> <p>Thus, the dynamics \(d\mathbf{x}_t = -\nabla E(\mathbf{x})\,dt + \sqrt{2}\,d\mathbf{W}_t\) has stationary distribution \(\propto e^{-E(\mathbf{x})}\), and \(d\mathbf{x}_t = \nabla_{\mathbf{x}} \log p(\mathbf{x}) \, dt + \sqrt{2} \, d\mathbf{W}_t\) has stationary distribution $p(\mathbf{x})$.</p> </div> </details> <p>Langevin dynamics, while widely used for sampling from complex distributions, becomes inefficient in high-dimensional or multi-modal settings due to slow mixing and sensitivity to hyperparameters such as step size and noise scale. However, Langevin dynamics play a crucial role as the foundation of diffusion models due to an important property: for \(p(\mathbf{x})\), Langevin dynamics act as an “identity” operation on the distribution, transforming a sample from \(p(\mathbf{x})\) into a new, independent sample from the same distribution.</p> <div class="row mt-3"> <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/langevin_id-480.webp 480w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/langevin_id-800.webp 800w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/langevin_id-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/langevin_id.png" class="img-fluid rounded" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Langevin dynamics acts as an identity operation on $p(\mathbf{x})$: starting from a sample $\mathbf{x} \sim p(\mathbf{x})$, it produces a new sample $\mathbf{x}'$ from the same distribution. </div> <h1 id="spliting-the-identity-into-forward-and-reverse-processes">Spliting the Identity into Forward and Reverse Processes</h1> <p>One key reason Langevin dynamics struggles in high-dimensional settings is the challenge of initialization. The score function required by it is learned from real data and is therefore reliable only near true data points, while being poorly estimated elsewhere. Yet in generative modeling we need to start from locations that may be far from the data manifold. Finding an initialization that is both realistic and close enough to the true data manifold is difficult, making effective generation with Langevin dynamics challenging in practice. In short, Langevin dynamics is well-suited for generating new samples from an existing one, but ill-suited for generating samples entirely from scratch.</p> <p>An enhancement to Langevin dynamics is the Annealed Langevin dynamics <d-cite key="song2019generative"></d-cite>. Instead of using a single Langevin sampler, this method involves training a sequence of Langevin dynamics, each corresponding to a different level of noise added to the data. Starting from pure noise, the method gradually reduces the noise level, switching between these samplers at each step. In this way, samples are progressively transformed from random noise into data-like samples, using Langevin dynamics that are effective for each stage of noise contamination. This approach highlights the importance of using multiple noise levels.</p> <p>Diffusion models take this concept a step further by completely separating the training and inference processes: one process trains the model at different noise levels, while another process samples from noise to generate data.</p> <h2 id="the-forward-diffusion-process-for-training">The Forward Diffusion Process for training</h2> <p>The forward diffusion process in DDPM generates the necessary training data: clean images and their progressively noised counterparts. In continuous time, a very general way to describe such a process is by an Itô SDE of the form</p> \[d \mathbf{x}_t = f(\mathbf{x}_t, t)\, dt + g(t)\, d\mathbf{W}_t, \label{Forward Process}\] <p>where \(t \in [0,T]\) is the forward diffusion time, \(\mathbf{x}_t\) is the noise-contaminated image at time \(t\), \(\mathbf{W}_t\) is a Brownian motion, \(f(\mathbf{x}_t, t)\) is the drift, and \(g(t)\) scales the injected noise. Different choices of \(f\) and \(g\) correspond to different forward-diffusion parameterizations used in diffusion models.</p> <p>In practice, diffusion models are usually instantiated by choosing specific parameterizations of this SDE. The most common ones are the <strong>variance-preserving (VP)</strong> process, implemented in DDPMs as an Ornstein–Uhlenbeck dynamics that gently pulls samples toward the origin while injecting noise so that the marginal converges to a standard Gaussian; the <strong>variance-exploding (VE)</strong> process, where there is no restoring drift and the noise scale grows with time so that the variance “explodes”; and <strong>flow-matching</strong> formulations, which view generation as following a time-dependent flow that implements an “straight line” interpolation between data and noise under a carefully designed schedule.</p> <p>The table below summarizes these three forward processes of different model types, as well as their corresponding SDEs expressed in terms of their respective noise-levels. In what follows, we adopt Karras’<d-cite key="Karras2022Elucidating"></d-cite> notation for the VE parameterization .</p> <div class="table-wrapper"> <table> <thead> <tr> <th><strong>Model Type</strong></th> <th><strong>Forward SDE</strong></th> <th><strong>Noise-level parameter</strong></th> <th><strong>Relation between initial and noisy variable</strong></th> </tr> </thead> <tbody> <tr> <td>Variance-preserving (VP)</td> <td>\(d x_t = - \tfrac{1}{2} x_t\, dt + dW_t\)</td> <td>\(\alpha_t = e^{-t}\)</td> <td>\(x_t = \sqrt{\alpha_t}\, x_0 + \sqrt{1-\alpha_t}\, \boldsymbol{\epsilon}\)</td> </tr> <tr> <td>Variance-exploding-Karras (VE-Karras)</td> <td>\(dz_{\sigma} = \sqrt{2\sigma}\, dW_{\sigma}\)</td> <td>\(\sigma\)</td> <td>\(z_\sigma = z_0 + \sigma\, \boldsymbol{\epsilon}\)</td> </tr> <tr> <td>Rectified flow</td> <td>\(dr_{s} = -\frac{r_s}{1-s}\, ds + \sqrt{\frac{2s}{1-s}}\, dW_{s}\)</td> <td>\(s\)</td> <td>\(r_s = (1-s)\, r_0 + s\, \boldsymbol{\epsilon}\)</td> </tr> </tbody> </table> </div> <p>Each forward process has a characteristic way of mixing data and noise: The VP model uses the Ornstein–Uhlenbeck (OU) process, blending the data with noise in a geometric (Pythagorean) fashion. The VE-Karras model adds noise directly to the data without a restoring drift, while the Rectified flow model creates a straight-line interpolation between data and noise. Despite their differences, all these SDEs are fundamentally equivalent—they differ only by how time and state are reparameterized. For clarity, the table below shows the transformations between time parameters and state variables for each model:</p> <div class="table-wrapper"> <table> <thead> <tr> <th><strong>Model Type</strong></th> <th><strong>Time variable</strong></th> <th><strong>Time domain</strong></th> <th><strong>State variable notation</strong></th> </tr> </thead> <tbody> <tr> <td>Variance-preserving (VP)</td> <td>\(t\)</td> <td>\([0, T]\)</td> <td>\(x_t\)</td> </tr> <tr> <td>Variance-exploding-Karras (VE-Karras)</td> <td>\(\sigma = \sqrt{e^{t} - 1}\)</td> <td>\([0, \Sigma]\)</td> <td>\(z_{\sigma(t)} = x_t e^{\frac{t}{2}}\)</td> </tr> <tr> <td>Rectified flow</td> <td>\(s= \dfrac{\sqrt{e^{t} - 1}}{1 + \sqrt{e^{t} - 1}}\)</td> <td>\([0, 1]\)</td> <td>\(r_{s(t)} = x_t \dfrac{e^{\frac{t}{2}}}{1 + \sqrt{e^{t} - 1}}\)</td> </tr> </tbody> </table> </div> <p>No matter which notation we choose, A forward diffusion step with a step size of \(\Delta t\) acts as adding more noise to data, which is displayed in the following picture:</p> <div class="row mt-3"> <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-480.webp 480w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-800.webp 800w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward.png" class="img-fluid rounded" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A forward diffusion step with step size $\Delta t$ adds Gaussian noise to data, pushing samples closer to a Gaussian distribution. </div> <h2 id="the-reverse-diffusion-process-for-sampling">The Reverse Diffusion Process for Sampling</h2> <p>The reverse diffusion process is the conjugate of the forward process. While the forward process evolves $p_t(\mathbf{x})$ toward Gaussian noise, the reverse process reverses this evolution, restoring Gaussian noise to $p_t$.</p> <p>The concept behind the reverse process is intuitive: since Langevin dynamics acts as an identity operation on a distribution—preserving it unchanged—any forward process composed with its corresponding reverse process should similarly yield an Langevin dynamics. Specifically, at any time $t$, combining the forward and reverse processes should reproduce the Langevin dynamics for the distribution $p_t(\mathbf{x})$, as illustrated in the following diagram.</p> <div class="row mt-3"> <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-reverse-langevin-480.webp 480w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-reverse-langevin-800.webp 800w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-reverse-langevin-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/forward-reverse-langevin.png" class="img-fluid rounded" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The forward and reverse diffusion processes compose to reproduce Langevin dynamics. </div> <p>To formalize this, consider the VP case with the following Langevin dynamics for $p_t(\mathbf{x})$ with a time variable $\tau$, distinguished from the forward diffusion time $t$. This dynamics can be decomposed into forward and reverse components as follows:</p> <div class="table-wrapper"> \[\begin{split} d\mathbf{x}_\tau &amp;= \mathbf{s}(\mathbf{x}_\tau, t) d\tau + \sqrt{2}\, d\mathbf{W}_\tau, \\ &amp;= \underbrace{-\frac{1}{2} \mathbf{x}_\tau d\tau + d\mathbf{W}_\tau^{(1)}}_{\text{Forward}} + \underbrace{ \left( \frac{1}{2} \mathbf{x}_\tau + \mathbf{s}(\mathbf{x}_\tau, t) \right)d\tau + d\mathbf{W}_\tau^{(2)}}_{\text{Reverse} }, \end{split}\] </div> <p>where \(\mathbf{s}(\mathbf{x}, t) = \nabla_{\mathbf{x}} \log p_t(\mathbf{x})\) is the score function of \(p_t(\mathbf{x})\). Here, we split the noise term \(\sqrt{2}\, d\mathbf{W}_\tau\) into two independent Gaussian increments, \(d\mathbf{W}_\tau^{(1)}\) and \(d\mathbf{W}_\tau^{(2)}\), such that their sum equals the original noise: \(\sqrt{2}\, d\mathbf{W}_\tau = d\mathbf{W}_\tau^{(1)} + d\mathbf{W}_\tau^{(2)}.\) This split is possible because Gaussian random variables satisfy the property that their sum is Gaussian, and independent Gaussians add in variance; specifically, if \(d\mathbf{W}_\tau^{(1)}\) and \(d\mathbf{W}_\tau^{(2)}\) are independent standard Brownian increments (each with variance $d\tau$), their sum has variance \(2\,d\tau\), matching the original \(\sqrt{2}\,d\mathbf{W}_\tau\).</p> <h4 id="how-does-the-reverse-process-invert-the-forward-process-to-generate-data-from-pure-noise">How does the reverse process invert the forward process to generate data from pure noise?</h4> <p>The “Forward” part in this decomposition corresponds to the forward diffusion process, effectively <strong>increasing the forward diffusion time $t$ by $d\tau$</strong>, bringing the distribution to $p_{t + d\tau}(\mathbf{x})$. Since the forward and reverse components combine to form an “identity” operation, the “Reverse” part must reverse the forward process—<strong>decreasing the forward diffusion time $t$ by $d\tau$</strong> and restoring the distribution back to $p_t(\mathbf{x})$.</p> <p>Now we can read the reverse process according to the reverse part in the equation above, and a reverse diffusion time $t’$ different from the forward diffusion time $t$:</p> \[d\mathbf{x}_{t'} = \left( \frac{1}{2} \mathbf{x}_{t'}+ \mathbf{s}(\mathbf{x}_{t'}, t) \right) dt' + d\mathbf{W}_{t'}.\] <p>The reverse diffusion process itself is also a standalone SDE that advances the reverse diffusion time $t’$. If \(\mathbf{x}_{t'} \sim q_{t'}(\mathbf{x})\), then one step of the reverse diffusion process with $dt’ = \Delta t’$ brings it to \(\mathbf{x}_{t' + \Delta t'} \sim q_{t' + \Delta t'}(\mathbf{x})\).</p> <h4 id="how-can-ode-based-and-sde-based-diffusion-models-be-unified-under-a-single-framework">How can ODE-based and SDE-based diffusion models be unified under a single framework?</h4> <p>The same decomposition approach can be applied to other diffusion schemes. The following table summarizes how each parameterization relates its Langevin dynamics to its corresponding forward and reverse processes:</p> <div class="table-wrapper"> <table> <thead> <tr> <th><strong>Model Type</strong></th> <th><strong>Langevin dynamics</strong></th> <th><strong>Forward Split</strong></th> <th><strong>Reverse Split</strong></th> </tr> </thead> <tbody> <tr> <td>VP-SDE</td> <td>\(dx = \mathbf{s}_x\, d\tau + \sqrt{2}\, d W_\tau\)</td> <td>\(d x = - \tfrac{1}{2} x\, d\tau + dW_\tau\)</td> <td>\(dx = \left[ \frac{1}{2} x + \mathbf{s}_x \right] d\tau + dW_{\tau}\)</td> </tr> <tr> <td>VP-ODE</td> <td>\(dx = \frac{1}{2} \mathbf{s}_x\, d\tau + d W_\tau\)</td> <td>\(d x = - \tfrac{1}{2} x\, d\tau\)</td> <td>\(dx = \frac{1}{2} \left( x + \mathbf{s}_x \right) d\tau\)</td> </tr> <tr> <td>VE-Karras</td> <td>\(dz = \tau\, \mathbf{s}_z\, d\tau + \sqrt{2 \tau}\, d W_\tau\)</td> <td>\(dz = \sqrt{2\tau}\, dW_{\tau}\)</td> <td>\(dz = \tau\, \mathbf{s}_z\, d\tau\)</td> </tr> <tr> <td>Rectified flow</td> <td>\(dr = \frac{\tau}{1+\tau} \mathbf{s}_r\, d\tau + \sqrt{\frac{2\tau}{1+\tau}}\, d W_\tau\)</td> <td>\(dr = -\frac{r}{1-\tau}\, d\tau + \sqrt{\frac{2\tau}{1-\tau}}\, dW_{\tau}\)</td> <td>\(dr = \frac{\tau\, \mathbf{s}_r + r}{1-\tau} d\tau\)</td> </tr> </tbody> </table> </div> <p>A key observation from this table is that we present two distinct splittings for the VP model: the SDE and ODE versions. Both are essentially decompositions of different Langevin dynamics, differing only in their time scaling functions $g(\tau)$. The ODE version corresponds to a splitting where the reverse process contains no stochastic term $dW$, effectively eliminating the Brownian noise component.</p> <p>Besides the decomposition of Langevin dynamics, we still have one problem: note that the $\mathbf{s}(\mathbf{x}_{t’}, t)$ term in the reverse process still depends on the forward time $t$, not the reverse time $t’$; we need the relationship between the forward time $t$ and the reverse time $t’$ to close the equation.</p> <p>Note that a single reverse-time step $dt’$ can be understood in two complementary ways:</p> <ol> <li> <p><strong>As an undoing of the forward diffusion:</strong> one step of the reverse diffusion process with $dt’ = \Delta t$ removes a small amount of noise and therefore <strong>reduces</strong> the forward diffusion time by $\Delta t$.</p> </li> <li> <p><strong>As forward evolution in its own clock:</strong> the reverse diffusion process is itself a well-defined SDE/ODE in the variable $t’$, so one step with $dt’ = \Delta t$ simply <strong>advances</strong> the reverse diffusion time from $t’$ to $t’ + \Delta t$:</p> </li> </ol> <p>Together, these two viewpoints determine how the forward and reverse clocks are related. Since a positive reverse-time step $dt’ &gt; 0$ both <strong>decreases</strong> the forward time $t$ and <strong>increases</strong> the reverse time $t’$, their infinitesimal increments must satisfy</p> \[dt = -dt'\] <p>which means that $t’$ runs in the opposite direction to $t$. To make $t’$ lie in the same range $[0, T]$ as the forward diffusion time, we can define</p> \[t = T - t',\] <p>so that $t = 0$ corresponds to $t’ = T$ and $t = T$ corresponds to $t’ = 0$.</p> <p>In this notation, the reverse diffusion process of VP is</p> \[d\mathbf{x}_{t'} = \left( \frac{1}{2} \mathbf{x}_{t'}+ \mathbf{s}(\mathbf{x}_{t'}, T-t') \right) dt' + d\mathbf{W}_{t'}, \label{Reverse Process}\] <p>in which $t’ \in [0,T]$ is the reverse time, $\mathbf{s}(\mathbf{x}, t) = \nabla_{\mathbf{x}} \log p_t(\mathbf{x})$ is the score function of the density of $\mathbf{x}_{t}$ in the forward process.</p> <p>The above analysis applies not only to SDE reverse processes but also to ODE reverse processes. The following table summarizes the reverse diffusion processes for different model types:</p> <div class="table-wrapper"> <table> <thead> <tr> <th><strong>Model Type</strong></th> <th><strong>Reverse Time</strong></th> <th><strong>Reverse time domain</strong></th> <th><strong>Reverse Process</strong></th> <th><strong>Relation to Score</strong></th> </tr> </thead> <tbody> <tr> <td>VP-SDE</td> <td>\(t' = T - t\)</td> <td>\(t' \in [0, T]\)</td> <td>\(dx_{t'} = \left[ \frac{1}{2} x_{t'}+ \mathbf{s}(x_{t'}, T-t') \right] dt' + dW_{t'}\)</td> <td>\(\mathbf{s}(x, t) = \mathbf{s}_x(x, t)\)</td> </tr> <tr> <td>VP-ODE</td> <td>\(t' = T - t\)</td> <td>\(t' \in [0, T]\)</td> <td>\(dx_{t'} = \frac{1}{2} \left[ x_{t'} + \mathbf{s} (x_{t'}, T-t') \right] dt'\)</td> <td>\(\mathbf{s}(x, t) = \mathbf{s}_x(x, t)\)</td> </tr> <tr> <td>VE-Karras</td> <td>\(\sigma' = \Sigma - \sigma\)</td> <td>\(\sigma' \in [0, \Sigma]\)</td> <td>\(dz_{\sigma'} = -\boldsymbol{\epsilon}(z_{\sigma'}, \Sigma-\sigma')d \sigma'\)</td> <td>\(\boldsymbol{\epsilon}(z, \sigma) = -\sigma \mathbf{s}_z(z, \sigma)\)</td> </tr> <tr> <td>Rectified flow</td> <td>\(s' = 1 - s\)</td> <td>\(s' \in [0, 1]\)</td> <td>\(dr_{s'} = -\mathbf{v} (r_{s'}, 1-s') ds'\)</td> <td>\(\mathbf{v}(r, s) = - \frac{s\, \mathbf{s}_r(r,s) + r_{s'}}{1-s}\)</td> </tr> </tbody> </table> </div> <h3 id="forward-reverse-duality">Forward-Reverse Duality</h3> <p>We have established that a single reverse step undoes a forward step: advancing the reverse time \(t'\) by an amount corresponds to decreasing the forward time \(t\) by the same amount. Now, let’s examine what happens when we combine multiple forward and reverse steps. Consider this sequence: begin with a data sample \(\mathbf{x}_0\), propagate it through the forward process to obtain \(\mathbf{x}_T\), then use \(\mathbf{x}_T\) as the starting point \(\mathbf{x}_{0'}\) for the reverse process and evolve it to \(\mathbf{x}_{T'}\). Part of this forward-reverse cycle is illustrated in the figure below.</p> <div class="row mt-3"> <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/FastestDiffusionTheory_08-480.webp 480w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/FastestDiffusionTheory_08-800.webp 800w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/FastestDiffusionTheory_08-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/FastestDiffusionTheory_08.jpg" class="img-fluid rounded diffusion-cycle-figure" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Part of a forward–reverse diffusion cycle: the last two steps of the forward process (green arrows, increasing $t$) followed by the first two steps of the reverse process (blue arrows, increasing $t'$ while decreasing $t$). </div> <p>The green arrows represent consecutive forward process steps that advance the forward diffusion time \(t\), while the blue arrows indicate consecutive reverse process steps that advance the reverse diffusion time \(t'\).</p> <p>We examine the relationship between \(\mathbf{x}_{t}\) in the forward diffusion process and \(\mathbf{x}_{t'=T-t}\) in the reverse diffusion process. The composition of a forward and a reverse step constitutes a Langevin dynamics step. This allows us to connect \(\mathbf{x}\) in the forward process with those in the reverse process through Langevin dynamics steps, as illustrated below:</p> <div class="row mt-3"> <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/FastestDiffusionTheory_09-480.webp 480w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/FastestDiffusionTheory_09-800.webp 800w,/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/FastestDiffusionTheory_09-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/2026/assets/img/2026-04-27-rethinking-diffusion-Langevin/FastestDiffusionTheory_09.jpg" class="img-fluid rounded" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Each horizontal row shows a Langevin dynamics step that maps a forward sample $\mathbf{x}_t$ to a new reverse sample $\mathbf{x}_{(T-t)'}$ from the same probability density. </div> <p><strong>Each horizontal row in this picture corresponds to consecutive steps of Langevin dynamics, which alters the samples while maintaining the same probability density</strong>. This illustrates the duality between the forward and reverse diffusion processes: while \(\mathbf{x}_t\) (forward) and \(\mathbf{x}_{(T-t)'}\) (reverse) are distinct samples, they obey the same probability distribution.</p> <p>To formalize the duality, we define the densities of \(\mathbf{x}_t\) (forward) as \(p_t(\mathbf{x})\), the densities of \(\mathbf{x}_{t'}\) (reverse) as \(q_{t'}(\mathbf{x})\). If we initialize</p> \[q_0(\mathbf{x}) = p_T(\mathbf{x}),\] <p>then their evolution are related by</p> \[q_{t'}(\mathbf{x}) = p_{T-t'}(\mathbf{x})\] <p>In diffusion models, the terminal time \(T\) is chosen to be sufficiently large so that the forward process distribution \(p_T(\mathbf{x})\) converges to a simple Gaussian distribution. This ensures that the reverse process can start from this well-defined Gaussian noise at \(t'=0\). By then evolving the reverse process through time \(t'\) from 0 to \(T\), we obtain samples that follow the original data distribution:</p> \[q_T(\mathbf{x}) = p_0(\mathbf{x}) \quad \text{(data distribution)}.\] <h4 id="why-are-diffusion-models-theoretically-superior-to-ordinary-vaes">Why are diffusion models theoretically superior to ordinary VAEs</h4> <p>The above result means that if we run the reverse process from time \(t' = 0\) to \(t' = T\), the final samples follow exactly the same distribution as the original training data \(p_0\). In other words, the forward and reverse processes form an exact prior–posterior pair: the forward process maps data to noise, and the reverse process maps noise back to data. In practice, training introduces approximation error, but the theoretical target is exact equality. Ordinary VAEs, by contrast, only require the decoder to approximate the encoder’s posterior, with no guarantee of exactness even at the ELBO optimum.</p> <p>Now we have demonstrated that <strong>reverse diffusion</strong>—the dual of the forward process—can generate image data from noise. However, this requires access to the score function $\mathbf{s}(\mathbf{x}, t) = \nabla_{\mathbf{x}} \log p_t(\mathbf{x})$ at every timestep $t$. In practice, we approximate this function using a neural network. In the next section, we will explain how to train such score networks.</p> <h1 id="maximal-likelihood-training-of-diffusion-models">Maximal likelihood Training of Diffusion Models</h1> <p>Training the reverse diffusion process involves addressing two fundamental questions: (1) What mathematical quantity should we model, and (2) What objective function should guide the training?</p> <p>The core mathematical object to model is the <strong>score function</strong>—the gradient of the log-probability density. However, contemporary implementations often parameterize the model to predict alternative quantities such as noise, clean data, or flow velocity. While these different parameterizations are mathematically equivalent (being rescaled versions of the same underlying score function), it is less transparent how the they should be explicitly incorporated into the same training objective.</p> <p>Our goal is to derive the training objective directly from first principles, beginning with the maximum likelihood framework. By doing so, we reveal the fundamental connection between diffusion model loss and exact maximum likelihood, without presupposing the existence or explicit usage of the score function.</p> <p>Suppose we have two distributions $p(\mathbf{x}, t)$ and $q(\mathbf{x}, t)$ that both evolve under the same forward diffusion process. Think of $p$ as the <strong>true data distribution</strong> pushed forward by the diffusion dynamics, and $q$ as the <strong>model distribution</strong>. At any fixed time $t$, their Kullback–Leibler (KL) divergence is</p> \[\mathrm{KL}\big(p_t \Vert q_t\big) = \int p(\mathbf{x}, t)\,\log \frac{p(\mathbf{x}, t)}{q(\mathbf{x}, t)}\,d\mathbf{x}.\] <p>Maximum likelihood training aims to minimize the KL divergence $\mathrm{KL}(p_0 \Vert q_0)$ at time $t=0$, where $p_0$ is the true data distribution and $q_0$ is the model distribution. However, in diffusion models, we introduce a forward process that evolves distributions over time $t$, and we learn a reverse process that maps from noisy states at different times back to clean data. This temporal structure suggests that rather than focusing solely on the KL divergence at $t=0$, we should consider how this divergence evolves throughout the entire diffusion process. The key insight is to “distribute” the KL minimization objective across all diffusion times by examining the time derivative of $\mathrm{KL}(p_t \Vert q_t)$ along the forward dynamics.</p> <p>Formally, we can express this idea by rewriting the KL at time $t=0$ as an integral over its time derivative:</p> \[\mathrm{KL}\big(p_0 \Vert q_0\big) = \mathrm{KL}\big(p_0 \Vert q_0\big) - \mathrm{KL}\big(p_\infty \Vert q_\infty\big) = -\int_0^{\infty}\frac{d}{dt} \mathrm{KL}\big(p_t \Vert q_t\big)\, dt\] <p>where the second equality uses $\mathrm{KL}\big(p_\infty \Vert q_\infty\big) = 0$ at infinitely large time $t$, since both $p$ and $q$ converge to the same Gaussian noise distribution.</p> <p>This naturally identifies the <strong>instantaneous contribution</strong> to the likelihood objective at time $t$ as</p> \[L_t = -\frac{d}{dt} \mathrm{KL}\big(p_t \Vert q_t\big),\] <p>so that minimizing $\mathrm{KL}(p_0 \Vert q_0)$ is equivalent to minimizing these contributions $L_t$ on average over diffusion time.</p> <p>We now show that as long as the forward diffusion process takes the form:</p> \[d\mathbf{x} = f(\mathbf{x}, t) \, dt + g(t) \, d\mathbf{W}.\] <p>the instantaneous contribution is</p> \[\begin{align*} L_t &amp;= \frac{1}{2} g(t)^2 \int p(\mathbf{x}, t)\, \big\|\nabla \log p(\mathbf{x}, t) - \nabla \log q(\mathbf{x}, t)\big\|^2 d\mathbf{x} \\ &amp;= \frac{1}{2} g(t)^2 \mathbb{E}_{\mathbf{x} \sim p(\mathbf{x}, t)} \big\|\nabla \log p(\mathbf{x}, t) - \nabla \log q(\mathbf{x}, t)\big\|^2 \end{align*}\] <p>where the score functions \(\nabla \log p(\mathbf{x}, t)\) and \(\nabla \log q(\mathbf{x}, t)\) for the true data distribution and the model distribution appear naturally inside the objective.</p> <details> <summary>Derivation Step 1 (optional): how the forward SDE induces the Fokker–Planck equation for $p_t(\mathbf{x})$</summary> <div class="details-content"> <p>Given the SDE</p> \[d\mathbf{x} = f(\mathbf{x}, t) \, dt + g(t) \, d\mathbf{W},\] <p>we first ask: <strong>how does the probabilistic density $p_t(\mathbf{x})$ evolve in time?</strong><br> The answer is the <strong>Fokker–Planck equation</strong>, which describes the time evolution of the probability density $p(\mathbf{x}, t)$ induced by the SDE:</p> \[\frac{\partial p}{\partial t} = -\nabla \cdot \left[f(\mathbf{x}, t)\, p\right] + \frac{1}{2}g(t)^2\, \nabla^2 p .\] <p>This PDE shows how <strong>drift</strong> $f$ and <strong>diffusion</strong> $g$ jointly shape the distribution. Rigorous derivations can be found in standard references; here we only sketch an intuitive 1D argument for the drift part:</p> <p><strong>Drift term $f$.</strong> Start with a 1D motion with <strong>constant velocity</strong> $v$, so $dx = v\,dt$. After time $t$, a particle now at position $x$ must have come from $x - vt$ at time $0$, so</p> \[p(x, t) = p(x - vt, 0).\] <p>Differentiating this identity w.r.t. $t$ gives the continuity equation</p> \[\frac{\partial p}{\partial t} + \frac{\partial}{\partial x}\big(v\, p(x, t)\big) = 0,\] <p>For a general 1D deterministic dynamics $dx = f(x, t)\,dt$, the same reasoning yields</p> \[\frac{\partial p}{\partial t} + \frac{\partial}{\partial x}\big(f(x, t)\, p(x, t)\big) = 0.\] <p>We keep $f(x, t)$ inside the $\partial_x$ because this term represents the probability flux. This guarantees conservation: integrating the total derivative $\partial_x(f p)$ over all space gives zero (assuming $p$ vanishes at boundaries), preserving the total probability.</p> <p><strong>Noise term $g\,dW$.</strong> Consider now the pure diffusion SDE $dx = g\,dW$ with constant $g$ and initial condition $x(0) = 0$. At time $t$, the accumulated Brownian motion from $0$ to $t$ is Gaussian with variance $t$, so $x(t)$ is Gaussian with variance $g^2 t$ and density</p> \[p(x, t) = \frac{1}{\sqrt{2\pi g^2 t}} \exp\!\left(-\frac{x^2}{2 g^2 t}\right).\] <p>One can check directly that this density satisfies the diffusion equation</p> \[\frac{\partial p}{\partial t} - \frac{1}{2} g^2 \frac{\partial^2 p}{\partial x^2} = 0.\] <p>Combining drift and diffusion, we obtain that</p> \[\frac{\partial p}{\partial t} = -\frac{\partial}{\partial x} \left[f(x, t)\, p\right] + \frac{1}{2} g(t)^2 \frac{\partial^2 p}{\partial x^2},\] <p>which is the 1D specialization of the Fokker–Planck equation stated above.</p> </div> </details> <details> <summary>Derivation Step 2 (optional): why this forward diffusion yields the squared-score objective above</summary> <div class="details-content"> <p>We now analyze <strong>how the KL divergence between two solutions of the same Fokker–Planck equation evolves in time</strong>.</p> <p>Assume that both $p(\mathbf{x}, t)$ and $q(\mathbf{x}, t)$ satisfy the same Fokker–Planck equation with drift $f(\mathbf{x}, t)$ and diffusion strength $g(t)$:</p> \[\frac{\partial p}{\partial t} = -\nabla \cdot \big(f p\big) + \frac{1}{2} g(t)^2 \nabla^2 p, \qquad \frac{\partial q}{\partial t} = -\nabla \cdot \big(f q\big) + \frac{1}{2} g(t)^2 \nabla^2 q.\] <p>Define</p> \[\mathrm{KL}\big(p_t \Vert q_t\big) := \int p(\mathbf{x}, t)\,\log\frac{p(\mathbf{x}, t)}{q(\mathbf{x}, t)}\,d\mathbf{x}.\] <p><strong>Step 1: Differentiate the KL.</strong><br> Differentiating under the integral sign and using $\int \partial_t p\,d\mathbf{x}=0$ (mass conservation), we obtain</p> \[\frac{d}{dt}\mathrm{KL}\big(p_t \Vert q_t\big) = \int \left(\log\frac{p}{q}\right)\partial_t p\,d\mathbf{x} - \int \frac{p}{q}\,\partial_t q\,d\mathbf{x}.\] <p>Introduce the Fokker–Planck operator</p> \[\mathcal{L}u = -\nabla\cdot(fu) + \frac{1}{2}g(t)^2\nabla^2 u,\] <p>so that $\partial_t p = \mathcal{L}p$ and $\partial_t q = \mathcal{L}q$. Let $r = p/q$. Then</p> \[\frac{d}{dt}\mathrm{KL}\big(p_t \Vert q_t\big) = \int \log r\,\mathcal{L}p\,d\mathbf{x} - \int r\,\mathcal{L}q\,d\mathbf{x}.\] <p><strong>Step 2: Drift does not change the KL.</strong><br> For the drift operator $-\nabla\cdot(fu)$, integration by parts (with vanishing boundary terms) gives</p> \[\int \log r\,\big[-\nabla\cdot(fp)\big]\,d\mathbf{x} = \int p\,f\cdot\nabla\log r\,d\mathbf{x},\] \[\int r\,\big[-\nabla\cdot(fq)\big]\,d\mathbf{x} = \int q\,f\cdot\nabla r\,d\mathbf{x}.\] <p>Using $r = p/q$ and $\nabla\log r = \nabla r / r$, one checks</p> \[p\,f\cdot\nabla\log r - q\,f\cdot\nabla r = 0,\] <p>so the <strong>drift part cancels exactly</strong> and does not affect $\mathrm{KL}(p_t\Vert q_t)$.</p> <p><strong>Step 3: Diffusion decreases the KL.</strong><br> For the diffusion operator $\tfrac{1}{2}g(t)^2\nabla^2 u$, integration by parts yields</p> \[\int \log r\cdot\frac{1}{2}g(t)^2\nabla^2 p\,d\mathbf{x} = -\frac{1}{2}g(t)^2\int \nabla\log r\cdot\nabla p\,d\mathbf{x},\] \[\int r\cdot\frac{1}{2}g(t)^2\nabla^2 q\,d\mathbf{x} = -\frac{1}{2}g(t)^2\int \nabla r\cdot\nabla q\,d\mathbf{x}.\] <p>Using</p> \[\nabla p = p\,\nabla\log p, \qquad \nabla q = q\,\nabla\log q,\qquad \nabla r = \nabla\!\left(\frac{p}{q}\right) = r\big(\nabla\log p - \nabla\log q\big),\] <p>we obtain</p> \[\nabla\log r\cdot\nabla p = p\big(\nabla\log p - \nabla\log q\big)\cdot\nabla\log p,\] \[\nabla r\cdot\nabla q = p\big(\nabla\log p - \nabla\log q\big)\cdot\nabla\log q.\] <p>Subtracting these contributions gives</p> \[-\frac{1}{2}g(t)^2\int \nabla\log r\cdot\nabla p\,d\mathbf{x} +\frac{1}{2}g(t)^2\int \nabla r\cdot\nabla q\,d\mathbf{x} = -\frac{1}{2}g(t)^2\int p(\mathbf{x},t) \big\|\nabla\log p - \nabla\log q\big\|^2\,d\mathbf{x}.\] <p><strong>Step 4: Conclusion.</strong><br> Putting drift and diffusion together,</p> \[\frac{d}{dt}\mathrm{KL}\big(p_t\Vert q_t\big) = -\frac{1}{2}g(t)^2 \int p(\mathbf{x},t)\, \big\|\nabla\log p(\mathbf{x},t) - \nabla\log q(\mathbf{x},t)\big\|^2 d\mathbf{x} \;\le 0.\] <p>Thus, along the forward diffusion process, the KL divergence between any two solutions of the same Fokker–Planck equation is <strong>non-increasing</strong>: diffusion strictly contracts KL (with equality only if the scores $\nabla\log p$ and $\nabla\log q$ coincide almost everywhere). This monotone decrease of $\mathrm{KL}(p_t \Vert q_t)$ justifies decomposing the global maximum-likelihood objective into local-in-time, squared-score terms associated with each diffusion step.</p> </div> </details> <p>In practice, we approximate the score function \(\nabla \log q(\mathbf{x}, t)\) using a neural network. For the standard score-based model, we directly model $\mathbf{s}_\theta(\mathbf{x}, t)$. For other formulations like VE-Karras and Rectified flow models, we instead model related functions: $\boldsymbol{\epsilon}$ (noise prediction) or $\mathbf{v}$ (velocity field), which can be transformed to obtain the score.</p> <p>The only thing remains to handle is the score of the true data distribution \(\nabla \log p(\mathbf{x}, t)\), which should be approximated by an empirical value from samples since we don’t know its value. In fact, we have</p> \[\text{argmin}_{\mathbf{s}_\theta} \mathbb{E}_{\mathbf{x}_0 \sim p_0}\, \mathbb{E}_{\mathbf{x}_t \sim p_t(\cdot \mid \mathbf{x}_0)} \big\|\nabla \log p(\mathbf{x}_t | \mathbf{x}_0) - \mathbf{s}_\theta\big\|^2 = \text{argmin}_{\mathbf{s}_\theta} \mathbb{E}_{\mathbf{x} \sim p(\mathbf{x}, t)} \big\|\nabla \log p(\mathbf{x}, t) - \mathbf{s}_\theta\big\|^2\] <p>where the LHS is the denoising score matching (DSM) loss while RHS is the score matching loss.</p> <details> <summary>Derivation (optional): equivalence between DSM and SM losses</summary> <div class="details-content"> <p>We now prove that the <em>denoising score matching</em> (DSM) loss and the <em>score matching</em> (SM) loss at time $t$ have the same minimizer.</p> <p><strong>Step 1: Define the two losses.</strong><br> Let us write the <em>denoising score matching</em> (DSM) loss at time $t$ as</p> \[L_{\text{DSM}}(\mathbf{s}_\theta) = \mathbb{E}_{\mathbf{x}_0 \sim p_0}\, \mathbb{E}_{\mathbf{x}_t \sim p_t(\cdot \mid \mathbf{x}_0)} \big\| \nabla_{\mathbf{x}_t} \log p_t(\mathbf{x}_t \mid \mathbf{x}_0) - \mathbf{s}_\theta(\mathbf{x}_t, t) \big\|^2,\] <p>and the <em>score matching</em> (SM) loss on the marginal $p_t(\mathbf{x}_t)$ as</p> \[L_{\text{SM}}(\mathbf{s}_\theta) = \mathbb{E}_{\mathbf{x}_t \sim p_t} \big\| \nabla_{\mathbf{x}_t} \log p_t(\mathbf{x}_t) - \mathbf{s}_\theta(\mathbf{x}_t, t) \big\|^2.\] <p>Here $p_t(\mathbf{x}_t) = \int p_t(\mathbf{x}_t \mid \mathbf{x}_0)\,p_0(\mathbf{x}_0)\,d\mathbf{x}_0$ is the marginal of the forward process at time $t$.</p> <p><strong>Step 2: Introduce conditional and marginal scores.</strong><br> Define the conditional score</p> <p>\(\mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0) := \nabla_{\mathbf{x}_t} \log p_t(\mathbf{x}_t \mid \mathbf{x}_0),\) and the marginal score</p> \[\mathbf{s}(\mathbf{x}_t, t) := \nabla_{\mathbf{x}_t} \log p_t(\mathbf{x}_t).\] <p><strong>Step 3: Expand both objectives.</strong><br> Using $|\mathbf{a}-\mathbf{b}|^2 = |\mathbf{a}|^2 + |\mathbf{b}|^2 - 2\langle \mathbf{a}, \mathbf{b}\rangle$, we can expand both objectives. For DSM,</p> \[\begin{aligned} L_{\text{DSM}}(\mathbf{s}_\theta) &amp;= \mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t} \big\| \mathbf{s}_\theta(\mathbf{x}_t, t) \big\|^2 - 2\,\mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t} \big\langle \mathbf{s}_\theta(\mathbf{x}_t, t), \mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0) \big\rangle \\ &amp;\quad + \mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t} \big\|\mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0)\big\|^2, \end{aligned}\] <p>where expectations are taken under the joint $p_0(\mathbf{x}_0)\,p_t(\mathbf{x}_t \mid \mathbf{x}_0)$. Similarly, for SM we have</p> \[\begin{aligned} L_{\text{SM}}(\mathbf{s}_\theta) &amp;= \mathbb{E}_{\mathbf{x}_t} \big\| \mathbf{s}_\theta(\mathbf{x}_t, t) \big\|^2 - 2\,\mathbb{E}_{\mathbf{x}_t} \big\langle \mathbf{s}_\theta(\mathbf{x}_t, t), \mathbf{s}(\mathbf{x}_t, t) \big\rangle \\ &amp;\quad + \mathbb{E}_{\mathbf{x}_t} \big\|\mathbf{s}(\mathbf{x}_t, t)\big\|^2. \end{aligned}\] <p><strong>Step 4: Match the first and last terms.</strong><br> The first terms coincide, because the marginal of the joint distribution is exactly $p_t(\mathbf{x}_t)$:</p> \[\mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t} \big\|\mathbf{s}_\theta(\mathbf{x}_t, t)\big\|^2 = \int p_t(\mathbf{x}_t) \big\|\mathbf{s}_\theta(\mathbf{x}_t, t)\big\|^2 \,d\mathbf{x}_t = \mathbb{E}_{\mathbf{x}_t} \big\|\mathbf{s}_\theta(\mathbf{x}_t, t)\big\|^2.\] <p>The last terms, \(\mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t}\|\mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0)\|^2\) and \(\mathbb{E}_{\mathbf{x}_t}\|\mathbf{s}(\mathbf{x}_t, t)\|^2\), do <strong>not</strong> depend on $\mathbf{s}_\theta$ at all, so they can only shift the loss by a constant.</p> <p><strong>Step 5: Handle the cross term.</strong><br> The only subtle point is the cross term. Because the inner product is linear, it is enough to prove that, for any (scalar) test function $f(\mathbf{x}_t)$,</p> \[\mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t} \big[ f(\mathbf{x}_t)\,\mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0) \big] = \mathbb{E}_{\mathbf{x}_t} \big[ f(\mathbf{x}_t)\,\mathbf{s}(\mathbf{x}_t, t) \big],\] <p>and then apply this to each coordinate of $\mathbf{s}_\theta(\mathbf{x}_t, t)$.</p> <p>By definition of the score,</p> \[\mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0) = \nabla_{\mathbf{x}_t} \log p_t(\mathbf{x}_t \mid \mathbf{x}_0) = \frac{\nabla_{\mathbf{x}_t} p_t(\mathbf{x}_t \mid \mathbf{x}_0)} {p_t(\mathbf{x}_t \mid \mathbf{x}_0)}.\] <p>Therefore,</p> \[\begin{aligned} \mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t} \big[ f(\mathbf{x}_t)\,\mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0) \big] &amp;= \iint p_0(\mathbf{x}_0)\, p_t(\mathbf{x}_t \mid \mathbf{x}_0)\, f(\mathbf{x}_t)\, \frac{\nabla_{\mathbf{x}_t} p_t(\mathbf{x}_t \mid \mathbf{x}_0)} {p_t(\mathbf{x}_t \mid \mathbf{x}_0)} \,d\mathbf{x}_t\,d\mathbf{x}_0 \\ &amp;= \iint f(\mathbf{x}_t)\, \nabla_{\mathbf{x}_t} p_t(\mathbf{x}_t \mid \mathbf{x}_0)\, p_0(\mathbf{x}_0)\, \,d\mathbf{x}_t\,d\mathbf{x}_0. \end{aligned}\] <p>Under mild regularity conditions we can interchange the order of integration and differentiation, obtaining</p> \[\begin{aligned} \mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t} \big[ f(\mathbf{x}_t)\,\mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0) \big] &amp;= \int f(\mathbf{x}_t)\, \nabla_{\mathbf{x}_t} \Big( \int p_t(\mathbf{x}_t \mid \mathbf{x}_0)\,p_0(\mathbf{x}_0)\,d\mathbf{x}_0 \Big) \,d\mathbf{x}_t \\ &amp;= \int f(\mathbf{x}_t)\,\nabla_{\mathbf{x}_t} p_t(\mathbf{x}_t)\,d\mathbf{x}_t \\ &amp;= \int p_t(\mathbf{x}_t)\, f(\mathbf{x}_t)\, \nabla_{\mathbf{x}_t} \log p_t(\mathbf{x}_t)\,d\mathbf{x}_t \\ &amp;= \mathbb{E}_{\mathbf{x}_t} \big[ f(\mathbf{x}_t)\,\mathbf{s}(\mathbf{x}_t, t) \big]. \end{aligned}\] <p>Taking \(f(\mathbf{x}_t)\) to be each component of \(\mathbf{s}_\theta(\mathbf{x}_t, t)\) shows that the DSM and SM cross terms are identical:</p> \[\mathbb{E}_{\mathbf{x}_0, \mathbf{x}_t} \big\langle \mathbf{s}_\theta(\mathbf{x}_t, t), \mathbf{s}(\mathbf{x}_t \mid \mathbf{x}_0) \big\rangle = \mathbb{E}_{\mathbf{x}_t} \big\langle \mathbf{s}_\theta(\mathbf{x}_t, t), \mathbf{s}(\mathbf{x}_t, t) \big\rangle.\] <p><strong>Conclusion.</strong> Putting everything together, we have</p> \[L_{\text{DSM}}(\mathbf{s}_\theta) = L_{\text{SM}}(\mathbf{s}_\theta) + C,\] <p>where $C$ is a constant independent of $\mathbf{s}_\theta$. Hence both objectives are minimized by the same function, namely the true marginal score</p> \[\mathbf{s}_\theta^\star(\mathbf{x}_t, t) = \nabla_{\mathbf{x}_t} \log p_t(\mathbf{x}_t).\] </div> </details> <p>This tells us that training the diffusion model, we only need to figure out the \(\nabla \log p(\mathbf{x}_t \| \mathbf{x}_0)\), then minimize the loss</p> \[L_t= \frac{1}{2} g(t)^2\mathbb{E}_{\mathbf{x}_0 \sim p_0}\, \mathbb{E}_{\mathbf{x}_t \sim p_t(\cdot \mid \mathbf{x}_0)} \big\|\nabla \log p(\mathbf{x}_t | \mathbf{x}_0) - \mathbf{s}_\theta\big\|^2\] <h4 id="how-can-denoising-score-matching-and-flow-matching-training-objectives-be-unified-and-derived-from-first-principles">How can Denoising, Score Matching, and Flow Matching training objectives be unified and derived from first principles?</h4> <p>With the above loss, we can unify training objective for different parameterizations considered in this article:</p> <div class="table-wrapper"> <table> <thead> <tr> <th><strong>Model Type</strong></th> <th><strong>Relation between initial and noisy variable</strong></th> <th><strong>Function modeled by NN</strong></th> <th><strong>$\mathbf{s}_\theta$ in terms of NN</strong></th> <th><strong>$\nabla \log p(x_t \mid x_0)$</strong></th> <th><strong>Loss $L_t$</strong></th> </tr> </thead> <tbody> <tr> <td>Variance-preserving (VP)</td> <td>\(x_t = \sqrt{\alpha_t}\, x_0 + \sqrt{1-\alpha_t}\, \boldsymbol{\epsilon}\)</td> <td>\(\mathbf{s}_{\theta}(x_t, t)\)</td> <td>\(\mathbf{s}_{\theta}(x_t, t)\)</td> <td>\(-\frac{\boldsymbol{\epsilon}}{\sqrt{1-\alpha_t}}\)</td> <td>\(\frac{1}{2}\mathbb{E}_{\mathbf{x}_0 \sim p_0}\mathbb{E}_{\mathbf{x}_t \sim p_t(\cdot \mid \mathbf{x}_0)}|| -\frac{\boldsymbol{\epsilon}}{\sqrt{1-\alpha_t}} - \mathbf{s}_{\theta}(x_t, t) ||^2\)</td> </tr> <tr> <td>Variance-exploding-Karras (VE-Karras)</td> <td>\(z_\sigma = z_0 + \sigma\, \boldsymbol{\epsilon}\)</td> <td>\(\boldsymbol{\epsilon}_{\theta}(z_\sigma, \sigma)\)</td> <td>\(-\frac{\boldsymbol{\epsilon}_{\theta}(z_\sigma, \sigma)}{\sigma}\)</td> <td>\(-\frac{\boldsymbol{\epsilon}}{\sigma}\)</td> <td>\(\frac{1}{\sigma}\mathbb{E}_{\mathbf{z}_0 \sim p_0}\mathbb{E}_{\mathbf{z}_\sigma \sim p_\sigma(\cdot \mid \mathbf{z}_0)} || \boldsymbol{\epsilon}_{\theta}(z_\sigma, \sigma) - \boldsymbol{\epsilon} ||^2\)</td> </tr> <tr> <td>Rectified flow</td> <td>\(r_s = (1-s)\, r_0 + s\, \boldsymbol{\epsilon}\)</td> <td>\(\mathbf{v}_{\theta}(r_s, s)\)</td> <td>\(\frac{ -\mathbf{v}_{\theta}(r_s, s) (1-s) - r_s }{s}\)</td> <td>\(-\frac{\boldsymbol{\epsilon}}{s}\)</td> <td>\(\frac{1-s}{s} \mathbb{E}_{\mathbf{r}_0 \sim p_0}\mathbb{E}_{\mathbf{r}_s \sim p_s(\cdot \mid \mathbf{r}_0)} || \boldsymbol{\epsilon}- r_0 - \mathbf{v}_{\theta}(r_s, s) ||^2\)</td> </tr> </tbody> </table> </div> <p>The table above shows the loss functions for different diffusion model types. For the VP model, the loss represents score matching that trains the score function. For the VE-Karras model, the loss is a denoising objective with a noise prediction model $\epsilon_\theta$. For the Rectified flow model, the loss is flow matching. These training objectives are now unified under the same maximum likelihood framework, answering the question:</p> <p>A note on loss weighting: In practice, the coefficient outside the L2 norm (such as $\frac{1}{2}$, $\frac{1}{\sigma}$, or $\frac{1-s}{s}$) is often omitted or replaced with a custom weighting schedule to improve training performance. This is valid because modifying this coefficient only changes the relative importance of the loss across different time steps $t$—it does not affect the optimal solution at any individual time $t$. In other words, reweighting adjusts how much we prioritize learning at different noise levels, but the target (the true score or velocity) remains unchanged.</p> <p>Combining all results from previous discussion, we summarize the forward, reverse, and loss for each diffusion type:</p> <div class="table-wrapper"> <table> <thead> <tr> <th><strong>Model Type</strong></th> <th><strong>Forward Process</strong></th> <th><strong>Reverse Process</strong></th> <th><strong>Loss (up to a weight factor)</strong></th> </tr> </thead> <tbody> <tr> <td>VP-SDE</td> <td>\(x_t = \sqrt{\alpha_t}\, x_0 + \sqrt{1-\alpha_t}\, \boldsymbol{\epsilon}\)</td> <td>\(dx_{t'} = \left[ \frac{1}{2} x_{t'}+ \mathbf{s}(x_{t'}, T-t') \right] dt' + dW_{t'}\)</td> <td>\(\mathbb{E}_{\mathbf{x}_0 \sim p_0}\mathbb{E}_{\mathbf{x}_t \sim p_t(\cdot \mid \mathbf{x}_0)}|| -\frac{\boldsymbol{\epsilon}}{\sqrt{1-\alpha_t}} - \mathbf{s}_{\theta}(x_t, t) ||^2\)</td> </tr> <tr> <td>VP-ODE</td> <td>\(x_t = \sqrt{\alpha_t}\, x_0 + \sqrt{1-\alpha_t}\, \boldsymbol{\epsilon}\)</td> <td>\(dx_{t'} = \frac{1}{2} \left[ x_{t'} + \mathbf{s} (x_{t'}, T-t') \right] dt'\)</td> <td>\(\mathbb{E}_{\mathbf{x}_0 \sim p_0}\mathbb{E}_{\mathbf{x}_t \sim p_t(\cdot \mid \mathbf{x}_0)}|| -\frac{\boldsymbol{\epsilon}}{\sqrt{1-\alpha_t}} - \mathbf{s}_{\theta}(x_t, t) ||^2\)</td> </tr> <tr> <td>VE-Karras</td> <td>\(z_\sigma = z_0 + \sigma\, \boldsymbol{\epsilon}\)</td> <td>\(dz_{\sigma'} = -\boldsymbol{\epsilon}(z_{\sigma'}, \Sigma-\sigma')d \sigma'\)</td> <td>\(\mathbb{E}_{\mathbf{z}_0 \sim p_0}\mathbb{E}_{\mathbf{z}_\sigma \sim p_\sigma(\cdot \mid \mathbf{z}_0)} || \boldsymbol{\epsilon}_{\theta}(z_\sigma, \sigma) - \boldsymbol{\epsilon} ||^2\)</td> </tr> <tr> <td>Rectified flow</td> <td>\(r_s = (1-s)\, r_0 + s\, \boldsymbol{\epsilon}\)</td> <td>\(dr_{s'} = -\mathbf{v} (r_{s'}, 1-s') ds'\)</td> <td>\(\mathbb{E}_{\mathbf{r}_0 \sim p_0}\mathbb{E}_{\mathbf{r}_s \sim p_s(\cdot \mid \mathbf{r}_0)} || \boldsymbol{\epsilon}- r_0 - \mathbf{v}_{\theta}(r_s, s) ||^2\)</td> </tr> </tbody> </table> </div> <p>For the VE-Karras model, the loss trains the network $\boldsymbol{\epsilon}_\theta$ to directly predict the Gaussian noise $\boldsymbol{\epsilon}$ added to the data; this is often called the epsilon-prediction parameterization. Other choices such as x0-prediction or v-prediction are algebraically equivalent reformulations of the same underlying objective.</p> <p>For the rectified flow model, observe that with $r_s = (1-s)\, r_0 + s\, \boldsymbol{\epsilon}$ we have $r_1 = \boldsymbol{\epsilon}$, so the loss can be written as</p> \[\big\| r_1 - r_0 - \mathbf{v}_{\theta}(r_s, s) \big\|^2 .\] <p>If we interpret $r_0$ and $r_1$ as the particle positions at times $s=0$ and $s=1$, then $r_1 - r_0$ is the average velocity over $[0,1]$, which motivates viewing \(\mathbf{v}_\theta\) as a velocity field and writing the reverse process as $dr = -\mathbf{v}(r,s)\, ds$. This has led to the intuition that rectified flows are trained on simple “straight lines” and are therefore conceptually simpler than general diffusion models. However, \(\mathbf{v}_\theta(r,s)\) still depends on time $s$, so the velocity changes over time and trajectories are not truly straight in state–time space. Since this velocity is directly related to the score function (as shown in the table), rectified flow is best understood as a particular parameterization of diffusion models rather than a fundamentally simpler class.</p> <h3 id="conclusion">Conclusion</h3> <p>From the Langevin perspective, diffusion models become conceptually simple: the forward and reverse processes are just a carefully chosen split of Langevin dynamics, which itself is an “identity map”. This viewpoint simultaneously explains how sampling inverts noising, unifies SDE and ODE formulations as different splittings of the same dynamics, and clarifies why diffusion models implement exact maximum likelihood in a way ordinary VAEs do not. It also shows a simple way to demonstrate that denoising, score matching, and flow matching are not competing “recipes,” but equivalent ways of estimating the same underlying score field that governs Langevin dynamics. We hope this perspective helps demystify diffusion models to learners, so that new variants can be understood not as disconnected tricks, but as different parameterizations and discretizations of a single, coherent Langevin story.</p> </body></html>